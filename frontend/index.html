<!-- frontend/index.html (Layout Atualizado e Bot√£o Funcional) -->
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>English Quiz - Configura√ß√£o</title>

    <!-- 1. Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. Axios (para chamadas de API) via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
      /* Estilos personalizados e fonte Inter */
      body {
        font-family: 'Inter', sans-serif;
        background-color: #f7f7f7;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      /* Estilos para os cards interativos */
      .interactive-card {
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .interactive-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      }
      .card-selected {
        border-color: #6366f1; /* indigo-500 */
        background-color: #fafaff;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        color: #4338ca; /* indigo-800 */
      }
      .card-default {
        border-color: #e5e7eb; /* gray-200 */
        background-color: #ffffff;
      }

      .container-quiz {
        max-width: 900px;
      }
      /* Anima√ß√£o de Shimmer (Carregamento) */
      .shimmer-card {
        background: linear-gradient(
          90deg,
          #e0e0e0 25%,
          #f5f5f5 50%,
          #e0e0e0 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
      }
      @keyframes shimmer {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 p-4">
    <div
      id="app"
      class="container-quiz w-full bg-white rounded-xl shadow-2xl p-6 md:p-10"
    >
      <!-- Cabe√ßalho -->
      <header class="text-center mb-12">
        <div class="text-6xl text-indigo-600 mb-4">üìñ</div>
        <h1 class="text-4xl font-bold text-gray-800">English Practice</h1>
        <p class="text-lg text-gray-500 mt-2">
          Melhore seu ingl√™s com exerc√≠cios personalizados. Escolha um tema e
          teste seus conhecimentos.
        </p>
      </header>

      <!-- SELE√á√ÉO DE N√çVEL (Bot√µes) -->
      <section class="mb-8">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">
          1. Escolha o N√≠vel de Dificuldade
        </h2>
        <div id="level-selection" class="grid grid-cols-3 gap-4">
          <button
            data-level="BEGINNER"
            class="level-button interactive-card p-4 border rounded-lg text-center"
          >
            <h3 class="font-semibold text-lg">Beginner</h3>
            <p class="text-sm text-gray-500">Conceitos b√°sicos</p>
          </button>
          <button
            data-level="INTERMEDIATE"
            class="level-button interactive-card p-4 border rounded-lg text-center"
          >
            <h3 class="font-semibold text-lg">Intermediate</h3>
            <p class="text-sm text-gray-500">Estruturas complexas</p>
          </button>
          <button
            data-level="ADVANCED"
            class="level-button interactive-card p-4 border rounded-lg text-center"
          >
            <h3 class="font-semibold text-lg">Advanced</h3>
            <p class="text-sm text-gray-500">Linguagem sofisticada</p>
          </button>
        </div>
      </section>

      <!-- SELE√á√ÉO DE QUANTIDADE (Cards) -->
      <section class="mb-8">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">
          2. Quantidade de Exerc√≠cios
        </h2>
        <div
          id="quantity-selection"
          class="grid grid-cols-2 md:grid-cols-4 gap-4"
        >
          <button
            data-quantity="5"
            class="quantity-button interactive-card p-4 border rounded-lg text-center"
          >
            <h3 class="font-semibold text-2xl">5</h3>
            <p class="text-sm text-gray-500">exerc√≠cios</p>
          </button>
          <button
            data-quantity="10"
            class="quantity-button interactive-card p-4 border rounded-lg text-center"
          >
            <h3 class="font-semibold text-2xl">10</h3>
            <p class="text-sm text-gray-500">exerc√≠cios</p>
          </button>
          <button
            data-quantity="15"
            class="quantity-button interactive-card p-4 border rounded-lg text-center"
          >
            <h3 class="font-semibold text-2xl">15</h3>
            <p class="text-sm text-gray-500">exerc√≠cios</p>
          </button>
          <button
            data-quantity="20"
            class="quantity-button interactive-card p-4 border rounded-lg text-center"
          >
            <h3 class="font-semibold text-2xl">20</h3>
            <p class="text-sm text-gray-500">exerc√≠cios</p>
          </button>
        </div>
      </section>

      <!-- SELE√á√ÉO DE CATEGORIA (Funcional) -->
      <section class="mb-8">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">
          3. Escolha uma Categoria
        </h2>
        <div
          id="category-cards-container"
          class="grid grid-cols-1 md:grid-cols-2 gap-6"
        >
          <!-- Estado de Carregamento (Shimmer) -->
          <div class="shimmer-card p-6 rounded-xl h-32"></div>
          <div class="shimmer-card p-6 rounded-xl h-32"></div>
        </div>
        <p id="loading-message" class="text-center text-indigo-600 mt-4">
          Carregando categorias do Backend...
        </p>
        <p id="error-message" class="text-center text-red-600 mt-4 hidden">
          Erro ao carregar categorias. Verifique o console (F12) e a
          configura√ß√£o de CORS no Backend.
        </p>
      </section>

      <!-- BOT√ÉO INICIAR QUIZ -->
      <div class="text-center pt-4 border-t">
        <button
          id="start-quiz-button"
          class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
          disabled
        >
          INICIAR QUIZ
        </button>
      </div>
    </div>

    <!-- L√ìGICA JAVASCRIPT -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Estado
        let selectedLevel = 'BEGINNER'; // Default
        let selectedQuantity = 5; // Default
        let selectedCategory = null;

        // Elementos DOM
        const levelButtons = document.querySelectorAll('.level-button');
        const quantityButtons = document.querySelectorAll('.quantity-button');
        const categoryContainer = document.getElementById(
          'category-cards-container',
        );
        const startButton = document.getElementById('start-quiz-button');
        const loadingMessage = document.getElementById('loading-message');
        const errorMessage = document.getElementById('error-message');

        const API_URL = '/api/v1/categories'; // URL Relativa (Nginx faz o proxy)

        // --- FUN√á√ïES DE L√ìGICA DE INTERFACE ---

        function initializeControls() {
          // Define sele√ß√£o padr√£o para N√≠vel
          const defaultLevelBtn = document.querySelector(
            `.level-button[data-level="${selectedLevel}"]`,
          );
          if (defaultLevelBtn) defaultLevelBtn.classList.add('card-selected');

          // Define sele√ß√£o padr√£o para Quantidade
          const defaultQtyBtn = document.querySelector(
            `.quantity-button[data-quantity="${selectedQuantity}"]`,
          );
          if (defaultQtyBtn) defaultQtyBtn.classList.add('card-selected');

          // Handlers dos Bot√µes de N√≠vel
          levelButtons.forEach((button) => {
            button.addEventListener('click', () => {
              levelButtons.forEach((btn) =>
                btn.classList.remove('card-selected'),
              );
              button.classList.add('card-selected');
              selectedLevel = button.getAttribute('data-level');
              checkStartButton();
            });
          });

          // Handlers dos Bot√µes de Quantidade
          quantityButtons.forEach((button) => {
            button.addEventListener('click', () => {
              quantityButtons.forEach((btn) =>
                btn.classList.remove('card-selected'),
              );
              button.classList.add('card-selected');
              selectedQuantity = parseInt(button.getAttribute('data-quantity'));
              checkStartButton();
            });
          });
        }

        function renderCategoryCards(categories) {
          categoryContainer.innerHTML = ''; // Limpa shimmers

          categories.forEach((category) => {
            const card = document.createElement('div');
            card.classList.add(
              'interactive-card',
              'p-6',
              'rounded-xl',
              'border',
              'shadow-sm',
            );
            card.setAttribute('data-category-name', category.name);

            // Define o estado inicial (sem sele√ß√£o)
            card.classList.add('card-default');

            card.innerHTML = `
                        <h3 class="text-lg font-bold text-gray-800">${category.name}</h3>
                        <p class="text-sm text-gray-500 mt-1">${category.description}</p>
                    `;

            card.addEventListener('click', () => {
              document
                .querySelectorAll('.interactive-card[data-category-name]')
                .forEach((c) => {
                  c.classList.remove('card-selected');
                  c.classList.add('card-default');
                });

              card.classList.add('card-selected');
              card.classList.remove('card-default');
              selectedCategory = category.name;
              checkStartButton();
            });
            categoryContainer.appendChild(card);
          });
        }

        function checkStartButton() {
          // O bot√£o s√≥ habilita se todos os 3 filtros estiverem selecionados
          if (selectedCategory && selectedLevel && selectedQuantity) {
            startButton.disabled = false;
          } else {
            startButton.disabled = true;
          }
        }

        // Lida com o clique do bot√£o Iniciar Quiz
        startButton.addEventListener('click', () => {
          const filters = {
            category: selectedCategory,
            level: selectedLevel,
            quantity: selectedQuantity,
          };

          console.log('--- CONFIGURA√á√ÉO DE QUIZ ENVIADA ---', filters);

          // Navega para a p√°gina do quiz, passando os filtros como par√¢metros de URL
          window.location.href = `/quiz.html?category=${filters.category}&level=${filters.level}&limit=${filters.quantity}`;
        });

        // --- FUN√á√ÉO DE BUSCA DA API ---
        async function fetchCategories() {
          try {
            console.log(`Tentando buscar categorias em: ${API_URL}`);
            const response = await axios.get(API_URL);

            if (
              response.status === 200 &&
              response.data &&
              response.data.length > 0
            ) {
              renderCategoryCards(response.data);
              loadingMessage.classList.add('hidden');
            } else {
              throw new Error(
                'Nenhuma categoria encontrada ou resposta vazia.',
              );
            }
          } catch (error) {
            console.error('Falha ao buscar categorias:', error.message);
            if (error.response)
              console.error('Detalhe (Resposta):', error.response.data);

            loadingMessage.classList.add('hidden');
            errorMessage.classList.remove('hidden');
            categoryContainer.innerHTML = '';
          }
        }

        // Inicia a aplica√ß√£o
        initializeControls();
        fetchCategories();
      });
    </script>
  </body>
</html>
